name: Run Tests
description: "Installs dependencies and runs unit tests"

# 1. Define inputs so the action can receive the version
inputs:
  python-version:
    description: "The python version to use"
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 10

    - name: Set up Python 
      uses: actions/setup-python@v5
      with:
        # 2. Use the input instead of matrix
        python-version: ${{ inputs.python-version }}

    - name: Install uv
      uses: astral-sh/setup-uv@v4

    - name: Use uv with Python version
      # 2. Use the input here as well
      run: uv venv --python ${{ inputs.python-version }}
      shell: bash

    - name: Install dependencies
      run: make install
      shell: bash

    - name: Build
      env:
        VERSION: 0.0.1
      run: make build
      shell: bash

    - name: Run tests
      run: |
        make test tests/unit-tests
      shell: bash
      env:
        # 2. And here
        PYTHON_VERSION: ${{ inputs.python-version }}